<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Databob.kotlin by daviddenton</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Databob.kotlin</h1>
      <h2 class="project-tagline">Randomised, zero-boilerplate object builders</h2>
      <a href="https://github.com/daviddenton/databob.kotlin" class="btn">View on GitHub</a>
      <a href="https://github.com/daviddenton/databob.kotlin/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/daviddenton/databob.kotlin/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="databobkotlin" class="anchor" href="#databobkotlin" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>databob.kotlin</h1>

<p><a href="https://coveralls.io/github/daviddenton/databob.kotlin?branch=master"><img src="https://coveralls.io/repos/daviddenton/databob.scala/badge.svg?branch=master" alt="coverage"></a>
<a href="http://kotlinlang.org"><img src="https://img.shields.io/badge/kotlin-1.0.0-blue.svg" alt="kotlin"></a>
<a href="https://travis-ci.org/daviddenton/databob.kotlin"><img src="https://travis-ci.org/daviddenton/databob.kotlin.svg?branch=master" alt="build status"></a>
<a href="https://bintray.com/daviddenton/maven/databob.kotlin/_latestVersion"><img src="https://api.bintray.com/packages/daviddenton/maven/databob.kotlin/images/download.svg" alt="bintray version"></a></p>

<h5>
<a id="also-available-in-scala-and-javascript-flavours" class="anchor" href="#also-available-in-scala-and-javascript-flavours" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>(Also available in <a href="https://github.com/daviddenton/databob.scala">Scala</a> and <a href="https://github.com/daviddenton/databob">JavaScript</a> flavours)</h5>

<p>Databob provides a way to generate completely randomised object builders with zero-boilerplate code.</p>

<h3>
<a id="why" class="anchor" href="#why" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Why?</h3>

<p>The problem of generating dummy test instances for our classes has been around for a long time. Given the following data classes...</p>

<div class="highlight highlight-source-Kotlin"><pre><span class="pl-k">data</span> class <span class="pl-en">ReadReceipt</span>(<span class="pl-k">val</span> <span class="pl-smi">read</span><span class="pl-k">:</span> <span class="pl-k">Boolean</span>)

<span class="pl-k">data</span> class <span class="pl-en">EmailAddress</span>(<span class="pl-k">val</span> <span class="pl-smi">value</span><span class="pl-k">:</span> <span class="pl-k">String</span>)

<span class="pl-k">data</span> class <span class="pl-en">Email</span>(<span class="pl-k">val</span> <span class="pl-smi">from</span><span class="pl-k">:</span> EmailAddress, <span class="pl-k">val</span> <span class="pl-smi">to</span><span class="pl-k">:</span> <span class="pl-k">List</span>&lt;EmailAddress&gt;, <span class="pl-k">val</span> <span class="pl-smi">date</span><span class="pl-k">:</span> ZonedDateTime, <span class="pl-k">val</span> <span class="pl-smi">read</span><span class="pl-k">:</span> <span class="pl-k">Boolean</span>, <span class="pl-k">val</span> <span class="pl-smi">subject</span><span class="pl-k">:</span> <span class="pl-k">String</span>, <span class="pl-k">val</span> <span class="pl-smi">readReceipt</span><span class="pl-k">:</span> Option&lt;ReadReceipt&gt;)

<span class="pl-k">data</span> class <span class="pl-en">Inbox</span>(<span class="pl-k">val</span> <span class="pl-smi">address</span><span class="pl-k">:</span> EmailAddress, <span class="pl-k">val</span> <span class="pl-smi">emails</span><span class="pl-k">:</span> <span class="pl-k">List</span>&lt;Email&gt;)</pre></div>

<p>We could start to write objects using the <a href="http://www.javacodegeeks.com/2013/06/builder-pattern-good-for-code-great-for-tests.html">TestBuilder</a> pattern using the traditional method:</p>

<div class="highlight highlight-source-Kotlin"><pre>class <span class="pl-en">InboxBuilder</span> {
    <span class="pl-k">private</span> <span class="pl-k">var</span> <span class="pl-en">address</span> <span class="pl-k">=</span> EmailAddress(<span class="pl-s"><span class="pl-pds">"</span>some@email.address.com<span class="pl-pds">"</span></span>)
    <span class="pl-k">private</span> <span class="pl-k">var</span> <span class="pl-en">emails</span> <span class="pl-k">=</span> listOf&lt;Email&gt;()

    <span class="pl-k">fun</span> <span class="pl-en">withAddress</span>(<span class="pl-smi">newAddress</span><span class="pl-k">:</span> EmailAddress) <span class="pl-k">=</span> {
        address <span class="pl-k">=</span> newAddress
        <span class="pl-c1">this</span>
    }

    <span class="pl-k">fun</span> <span class="pl-en">withEmails</span>(<span class="pl-smi">newEmails</span><span class="pl-k">:</span> <span class="pl-k">List</span>&lt;Email&gt;) <span class="pl-k">=</span> {
        emails <span class="pl-k">=</span> newEmails
        <span class="pl-c1">this</span>
    }

    <span class="pl-k">fun</span> <span class="pl-en">build</span>() <span class="pl-k">=</span> Inbox(address, emails)
}</pre></div>

<p>Kotlin makes this easier for us somewhat by leveraging data class <code>copy()</code>. This also allows us to be compiler safe, as removing 
a field will break the equivalent <code>with</code> method:</p>

<div class="highlight highlight-source-Kotlin"><pre>class <span class="pl-en">InboxBuilder</span> {
  <span class="pl-k">private</span> <span class="pl-k">var</span> <span class="pl-en">inbox</span> <span class="pl-k">=</span> Inbox(EmailAddress(<span class="pl-s"><span class="pl-pds">"</span>some@email.address.com<span class="pl-pds">"</span></span>), List[Email]())

  def withAddress(newAddress<span class="pl-k">:</span> EmailAddress) <span class="pl-k">=</span> {
    inbox <span class="pl-k">=</span> inbox<span class="pl-k">.</span>copy(address <span class="pl-k">=</span> newAddress)
    <span class="pl-c1">this</span>
  }

  def withEmails(newEmails<span class="pl-k">:</span> List[Email]) <span class="pl-k">=</span> {
    inbox <span class="pl-k">=</span> inbox<span class="pl-k">.</span>copy(emails <span class="pl-k">=</span> newEmails)
    <span class="pl-c1">this</span>
  }

  def build <span class="pl-k">=</span> inbox
}</pre></div>

<p>Taking this even further with data class copy(), we can reduce this to:</p>

<div class="highlight highlight-source-Kotlin"><pre>class <span class="pl-en">BetterInboxBuilder</span> <span class="pl-en">private</span> <span class="pl-en">constructor</span>(<span class="pl-k">private</span> <span class="pl-k">val</span> <span class="pl-smi">inbox</span><span class="pl-k">:</span> Inbox) {

    constructor() <span class="pl-k">:</span> <span class="pl-c1">this</span>(Inbox(EmailAddress(<span class="pl-s"><span class="pl-pds">"</span>some@email.address.com<span class="pl-pds">"</span></span>), listOf&lt;Email&gt;()))

    <span class="pl-k">fun</span> <span class="pl-en">withAddress</span>(<span class="pl-smi">newAddress</span><span class="pl-k">:</span> EmailAddress) <span class="pl-k">=</span> BetterInboxBuilder(inbox<span class="pl-k">.</span>copy(address <span class="pl-k">=</span> newAddress))

    <span class="pl-k">fun</span> <span class="pl-en">withEmails</span>(<span class="pl-smi">newEmails</span><span class="pl-k">:</span> <span class="pl-k">List</span>&lt;Email&gt;) <span class="pl-k">=</span> BetterInboxBuilder(inbox<span class="pl-k">.</span>copy(emails <span class="pl-k">=</span> newEmails))

    <span class="pl-k">fun</span> <span class="pl-en">build</span>() <span class="pl-k">=</span> inbox
}</pre></div>

<p>So, better - but it still seems pretty tedious to maintain. Additionally, we don't really want tests to rely unknowingly on 
bits of default test data for multiple tests which will lead to an explosion of <a href="http://martinfowler.com/bliki/ObjectMother.html">ObjectMother</a>-type methods with small variations 
to suit particular tests.</p>

<p>What we really want are completely randomised instances, with important overrides set-up only for tests that rely on them. No sharing of test data across tests. Ever.</p>

<p>Enter Databob. For a completely randomised instance, including non-primitive sub-tree objects:</p>

<div class="highlight highlight-source-Kotlin"><pre>Databob()<span class="pl-k">.</span>mk(Email<span class="pl-k">::</span>class)</pre></div>

<p>That's it. Want to override particular value(s)?</p>

<div class="highlight highlight-source-Kotlin"><pre>Databob()<span class="pl-k">.</span>mk(Email<span class="pl-k">::</span>class)<span class="pl-k">.</span>copy(from <span class="pl-k">=</span> EmailAddress(<span class="pl-s"><span class="pl-pds">"</span>my@real.email.com<span class="pl-pds">"</span></span>))</pre></div>

<p>Or add your own rule for generating values?</p>

<div class="highlight highlight-source-Kotlin"><pre><span class="pl-k">val</span> <span class="pl-en">override</span> <span class="pl-k">=</span> Generators<span class="pl-k">.</span>ofType { databob <span class="pl-k">-&gt;</span> EmailAddress(databob<span class="pl-k">.</span>mk(<span class="pl-k">String</span><span class="pl-k">::</span>class) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>@<span class="pl-pds">"</span></span> <span class="pl-k">+</span> databob<span class="pl-k">.</span>mk(<span class="pl-k">String</span><span class="pl-k">::</span>class) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>.com<span class="pl-pds">"</span></span>) }

Databob(<span class="pl-k">override</span>)<span class="pl-k">.</span>mk(Email<span class="pl-k">::</span>class)</pre></div>

<h3>
<a id="out-of-the-box-features" class="anchor" href="#out-of-the-box-features" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Out-of-the-box features:</h3>

<ul>
<li>Nested object-trees (ie. non-primitive fields)</li>
<li>All Kotlin/Java primitives</li>
<li>Kotlin and Java Collection classes</li>
<li>Java8 date-time values</li>
<li>Bindings for Funktionale monadic types (Option/Either)</li>
<li>Simple overriding mechanism for your own-types and custom generation rules</li>
</ul>

<h3>
<a id="see-it-in-action" class="anchor" href="#see-it-in-action" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>See it in action</h3>

<p>See the <a href="https://github.com/daviddenton/databob.kotlin/tree/master/src/test/kotlin/examples">example code</a>.</p>

<h3>
<a id="get-it" class="anchor" href="#get-it" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Get it</h3>

<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">dependency</span>&gt;
  &lt;<span class="pl-ent">groupId</span>&gt;io.github.daviddenton&lt;/<span class="pl-ent">groupId</span>&gt;
  &lt;<span class="pl-ent">artifactId</span>&gt;databob.kotlin&lt;/<span class="pl-ent">artifactId</span>&gt;
  &lt;<span class="pl-ent">version</span>&gt;X.X.X&lt;/<span class="pl-ent">version</span>&gt;
&lt;/<span class="pl-ent">dependency</span>&gt;</pre></div>

<p>For extension binding support (such as Funktionale, you'll need to also add relevant dependencies)</p>

<h3>
<a id="contribute" class="anchor" href="#contribute" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Contribute</h3>

<p>PRs gratefully accepted for other common types that might be useful.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/daviddenton/databob.kotlin">Databob.kotlin</a> is maintained by <a href="https://github.com/daviddenton">daviddenton</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
